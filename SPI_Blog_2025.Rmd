---
title: "2025 Update of the Statistical Performance Indicators"
author: "Prepared by Adam Landau, Zander Prinsloo, Umar Serajuddin, Brian Stacy"
date: "`r Sys.Date()`"
output:
  word_document: default
bibliography: []
---

```{r setup, include=FALSE}
# ---- knitr defaults ----
knitr::opts_chunk$set(
  echo = FALSE,
  fig.height = 6,
  fig.path   = "plots/",
  fig.width  = 9.5,
  message    = FALSE,
  warning    = FALSE,
  dev        = c("png"),
  dpi        = 500
)
#library(Hmisc)
#library(patchwork)
#library(ggpmisc)
# ---- packages ----
library(readxl)
library(tidyverse)   # includes readr, readxl, purrr, dplyr, etc.
library(flextable)
library(here)
library(ggthemes)
library(httr)
library(ggrepel)
library(haven)       # Stata/SAS/SPSS
library(zoo)
library(dplyr)
library(tidyverse)
library(readr)
library(ggtext)
library(estimatr)
library(stringr)
# ---- project directories (relative to repo root) ----
#set directories
dir <- "/Users/landau/Documents/GitHub/SPI" # set locally to debug 
setwd("/Users/landau/Desktop/What's New 2025") # set locally to debug 
raw_dir <- paste(dir, '01_raw_data', sep="/")
output_dir <- paste(dir, '03_output_data', sep="/")

# ---- parameters ----
wgt        <- 1
end_date   <- 2024
start_date <- 2016

# ---- small helpers for importing ----

# **Overview**: The 2025 Statistical Performance Indicators (SPI) release includes data from 2024 with updates to previous years, incorporating the latest information from organizations such as the World Bank, IMF, and UN Agencies. The SPI continues to assess national statistical systems across five pillars with 22 dimensions, though data is currently available for 14 of these dimensions.

#  **Methodology Consistency**: Since the 2019 release, the scoring methodology and data sources have remained largely unchanged, ensuring consistency and comparability with prior releases. The only exception is the indicator for comparable poverty measures in the data use pillar. Previously, high-income countries not covered by PovcalNet were assigned a score of 1 due to the lack of data. However, with expanded coverage in the Poverty and Inequality Platform (PIP) since 2021, all countries are now assessed based on the availability of comparable poverty data.

#  **Data Updates**: Revisions to previous SPI scores were made to reflect updated data, particularly in Pillars 1, 3, and 4, with minimal impact on overall scores. The correlation between the previous and revised scores remains high, with a 0.99 correlation in 2022.

# **Data Coverage**: The SPI now includes 187 economies, up from 167 in 2016, covering over 99% of the global population. This expansion is largely driven by an increase in economies with data openness scores.

#  **Score Improvements**: Global SPI scores have risen by an average of 12.9 points from 2016 to 2024. Country rankings have remained stable, with a Spearman rank correlation of 0.92.

#  **Performance by Decile**: The largest improvements were observed in countries that ranked in the bottom 20% in 2016. In contrast, countries in the top decile showed minimal growth due to their already high scores.

# **Pillar Contributions**: Improvements in data services and infrastructure have been the major contributors to overall score increases, especially in the bottom deciles. Specifically, 43% of the improvements in the bottom decile are attributed to better data services, and 22% to better data infrastructure.

#  **Regional and Income Group Analysis**: North America and Europe & Central Asia are the top-performing regions. The next highest scoring regions on average, after excluding countries with small populations, are East Asia & the Pacific region, Latin America & the Caribbean, South Asia, the Middle East and North Africa, and Sub-Saharan Africa, in that order. Statistical performance improves with income, with lower-middle-income countries showing the fastest growth, followed by low-income, upper-middle-income, and high-income countries.

#  **Population Size Impact**: High-income countries with populations under 500,000 face specific challenges, scoring the same on average (56 points) as the average for all low-income countries. This suggests that small economies may face unique challenges in building statistical capacity.

#  **Conclusion**: The 2025 SPI release highlights significant progress in global statistical performance, driven by improvements in data services and infrastructure. While top-performing regions and countries maintain their ranks, lower middle-income and smaller economies show promising advancements. This trend indicates a positive development in global data and statistical capacity building. For further details, the [SPI research paper](https://www.nature.com/articles/s41597-023-01971-0) and the [SPI GitHub repository](https://github.com/worldbank/SPI) provide additional information on how the SPI is put together, as well as the raw data and code.


#ggplot theme
theme_spi <- function () { 
    theme_minimal(base_size = 14) %+replace%
    theme(
      plot.title = element_text(face = "bold", size = 16, color = "#333333"),
      plot.subtitle = element_text(size = 14, color = "#666666"),
      axis.title = element_text(face = "bold"),
      legend.title = element_blank(),
      legend.position = "top",
      legend.text = element_text(size = 12),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.line = element_line(color = "#cccccc")
  )
}



# ---- themes & palettes ----
theme_spi <- function () {
  theme_minimal(base_size = 14) %+replace%
    theme(
      plot.title    = element_text(face = "bold", size = 16, color = "#333333"),
      plot.subtitle = element_text(size = 14, color = "#666666"),
      axis.title    = element_text(face = "bold"),
      legend.title  = element_blank(),
      legend.position = "top",
      legend.text   = element_text(size = 12),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.line     = element_line(color = "#cccccc")
    )
}

# Distinct colors on the fly for arbitrary label sets
.make_palette <- function(levels_vec, default_hex = NULL) {
  lv <- unique(levels_vec[!is.na(levels_vec)])
  n  <- length(lv)
  if (n == 0) return(c())
  # Use your existing hexes if you want stable branding, otherwise hue_pal
  if (!is.null(default_hex)) {
    # recycle or trim provided palette to n
    pal <- rep(default_hex, length.out = n)
  } else {
    pal <- scales::hue_pal()(n)
  }
  names(pal) <- lv
  pal
}

# Dynamic palettes from actual data (no hard-coding)


income_levels       <- c("Low income","Lower middle income","Upper middle income","High income")
income_colors       <- c("#fb8500","#ffb703","#219ebc","#023047"); names(income_colors) <- income_levels


pillar_levels       <- c("Pillar 1: Data Use","Pillar 2: Data Services","Pillar 3: Data Products",
                         "Pillar 4: Data Sources","Pillar 5: Data Infrastructure")
pillar_colors       <- c("#fee440","#9b5de5","#00bbf9","#00f5d4","#f15bb5"); names(pillar_colors) <- pillar_levels

```

```{r data}
spi_index_df<-readr::read_csv('https://raw.githubusercontent.com/worldbank/SPI/SPI_2024/03_output_data/SPI_index.csv')
# %>%
#   filter(date>=2021) %>%
#   bind_rows(read_csv( file = paste(output_dir, 'SPI_index_2020.csv', sep="/")) %>% filter(date==2020)) %>%
#   bind_rows(read_csv( file = paste(output_dir, 'SPI_index_2019.csv', sep="/")) %>% filter(date<2020))            
#metadata 

#metadata 
metadata2 <- read_csv(paste(raw_dir, '/metadata/SPI_dimensions_sources.csv', sep=""))

metadata_full <- read_csv(paste(raw_dir, '/metadata/SPI_index_sources.csv', sep="")) %>%
  rename(source_name=descript) %>%
  bind_rows(metadata2)

# add new regions to SPI database
class_data <- read_dta(paste(raw_dir, '/misc/CLASS.dta', sep="/")) %>%
  # Get the most recent year for each country
  group_by(code) %>%
  arrange(desc(year_fiscal)) %>%
  slice(1) %>%
  ungroup() %>%
  # Select and rename columns to match existing code
  transmute(
    iso3c = code,
    country = economy,
    region = region,
    income = incgroup,
    lending_type = ida,
    fcv = fcv,
    fragile_conflict = case_when(
      fcv == "Yes" ~ "FCS country",
      TRUE ~ "Non-FCS country"
    )
  )

# Remove any existing classification columns from spi_index_df to avoid conflicts
spi_index_df <- spi_index_df %>%
  select(-any_of(c("region", "income", "lending_type", "fcv", "fragile_conflict"))) %>%
  left_join(class_data %>% select(-country), by = "iso3c")

region_levels       <- spi_index_df |> dplyr::distinct(region) |> dplyr::pull(region)
lending_levels      <- spi_index_df |> dplyr::distinct(lending_type) |> dplyr::pull(lending_type)
region_colors       <- .make_palette(region_levels)  # hue-based
lending_colors      <- .make_palette(lending_levels)


```

```{r}

#get list of economies with score in 2016 to keep countries fixed.
list_2016 <- spi_index_df %>% filter(date==start_date) %>% filter(!is.na(SPI.INDEX))
list_2016 <- list_2016$iso3c
#aggregate to global level
spi_agg_df <- spi_index_df %>%
  filter(iso3c %in% list_2016) %>% #keep countries fixed.
  group_by(date) %>%
  summarise(across(starts_with("SPI."),mean, na.rm=T)) 

```

```{r programs, include=FALSE}


#For mapping the result
# quality = "high"
# maps <- wbgmaps::wbgmaps[[quality]]
#load world bank map data
load(paste0(raw_dir, '/misc/maps.Rdata'))
standard_crop_wintri <- function() {
  l <- list(
    left=-12000000, right=16396891,
    top=9400000, bottom=-6500000
  )
  l$xlim <- c(l$left, l$right)
  l$ylim <- c(l$bottom, l$top)
  l
}


country_metadata <- wbstats::wb_countries()




spi_mapper  <- function(data, indicator, title) {
  
 indicator<-indicator

  map_df <- get(data) %>%
    filter(date==max(date, na.rm=T)) %>%
    filter(!(country %in% c('Greenland'))) %>% #drop a few countries for which we do not collect data.
    group_by( iso3c) %>%
    #summarise(across(!! indicator,last)) %>%
    rename(data_available=!! indicator) %>%
    select(iso3c, date, data_available, weights) %>%
    right_join(country_metadata) %>%
    mutate(data_available=if_else(is.na(data_available), as.numeric(NA), as.numeric(data_available)))     


  spi_groups_quantiles <- quantile(map_df$data_available, probs=c(1,2,3,4)/5,na.rm=T)
  
  SPI_map <- map_df %>%
    mutate(spi_groups=case_when(
      between(data_available, spi_groups_quantiles[4],100) ~ "Top Quintile",
      between(data_available, spi_groups_quantiles[3],spi_groups_quantiles[4]) ~ "4th Quintile",
      between(data_available, spi_groups_quantiles[2],spi_groups_quantiles[3]) ~ "3rd Quintile",
      between(data_available, spi_groups_quantiles[1],spi_groups_quantiles[2]) ~ "2nd Quintile",
      between(data_available, 0,spi_groups_quantiles[1]) ~ "Bottom 20%"
      
    )) %>%
    mutate(spi_groups=factor(spi_groups, 
                             levels=c("Top Quintile","4th Quintile","3rd Quintile","2nd Quintile","Bottom 20%" )))  
  
  #set color pallete
  col_pal <- c("#2ec4b6","#acece7","#f1dc76","#ffbf69","#ff9f1c")  
  names(col_pal) <- c("Top Quintile","4th Quintile","3rd Quintile","2nd Quintile","Bottom 20%" )
  
  p1<-ggplot() +
    geom_map(data = SPI_map, aes(map_id = iso3c, fill = spi_groups), map = maps$countries) + 
    geom_polygon(data = maps$disputed, aes(long, lat, group = group, map_id = id), fill = "grey80") + 
    geom_polygon(data = maps$lakes, aes(long, lat, group = group), fill = "white")  +
    geom_path(data = maps$boundaries,
              aes(long, lat, group = group),
              color = "white",
              size = 0.3,
              lineend = maps$boundaries$lineend,
              linetype = maps$boundaries$linetype) +
    scale_x_continuous(expand = c(0, 0), limits = standard_crop_wintri()$xlim) +
    scale_y_continuous(expand = c(0, 0), limits = standard_crop_wintri()$ylim) +
    scale_fill_manual(
      name='SPI Score',
      values=col_pal,
      na.value='grey'
    ) +
    coord_equal() +
    theme_map(base_size=12) +
    labs(
      title=str_wrap(title,100),
      caption = 'Source: World Bank. Statistical Performance Indicators'
    )
 print(p1)
}

spi_region_charts <- function(data, indicator, title) {

  map_df <- get(data) |>
    dplyr::filter(date == max(date, na.rm = TRUE)) |>
    dplyr::group_by(iso3c) |>
    dplyr::rename(data_available = !!indicator) |>
    dplyr::select(iso3c, date, data_available, weights, region) |>
    dplyr::ungroup() |>
    dplyr::mutate(data_available = if_else(is.na(data_available), NA_real_, as.numeric(data_available)))

  region_SPI_df <- map_df |>
    dplyr::filter(!is.na(region)) |>
    dplyr::group_by(region) |>
    dplyr::mutate(`SPI Score` = Hmisc::wtd.mean(data_available, weights = weights, na.rm = TRUE),
                  Label = paste(round(`SPI Score`, 0))) |>
    dplyr::summarise(`SPI Score` = dplyr::first(`SPI Score`), Label = dplyr::first(Label), .groups = "drop") |>
    dplyr::arrange(dplyr::desc(`SPI Score`)) |>
    dplyr::mutate(region = factor(region, levels = region))

  ggplot(region_SPI_df, aes(x = `SPI Score`, y = region, fill = region)) +
    geom_bar(stat = "identity", position = "dodge") +
    geom_text(aes(label = Label)) +
    scale_fill_manual(values = region_colors) +
    labs(
      title    = stringr::str_wrap(paste(title, "By Region", sep = " - "), 100),
      caption  = "Source: World Bank. Statistical Performance Indicators.",
      subtitle = paste0("Based on data for ", end_date, " or the latest year available")
    ) +
    expand_limits(x = c(0, 100)) +
    theme_spi() +
    theme(legend.position = "top")
}

spi_income_charts  <- function(data, indicator, title) {
  
    map_df <- get(data) %>%
    filter(date==max(date, na.rm=T)) %>%
    filter(!(country %in% c('Greenland'))) %>% #drop a few countries for which we do not collect data.
    group_by( iso3c) %>%
    #summarise(across(!! indicator,last)) %>%
    rename(data_available=!! indicator) %>%
    select(iso3c, date, data_available, weights) %>%
    right_join(country_metadata) %>%
    mutate(data_available=if_else(is.na(data_available), as.numeric(NA), as.numeric(data_available)))  
    
    
    
    


  # p2_alt <- map_df %>%
  #   ungroup() %>%
  #   filter(region!='Aggregates') %>%
  #   mutate(`SPI Score`=(data_available),
  #          Label = paste(round(`SPI Score`,0))) %>%
  #   ggplot(aes(x=`SPI Score`, y=region, color=region)) +
  #     geom_point() +
  #     geom_text(aes(label=country), position=position_jitter(width=.1,height=.4), check_overlap=T) +
  #     labs(
  #     title=str_wrap(paste(title, 'By Country', sep=" - "),100),
  #     caption = 'Source: World Bank. Statistical Performance Indicators.',
  #     subtitle= paste0('Based on data for ',end_date,' or the latest year available')
  #     ) +
  #     expand_limits(x=c(0,100)) +
  #     theme_spi() +
  #     theme(legend.position = 'top')  
  
  #by income
    income <- c("Low income", "Lower middle income","Upper middle income","High income")

    p3 <- map_df %>%
    group_by(income) %>%
    filter(region!='Aggregates') %>%
    mutate(`SPI Score`=wtd.mean(data_available, weights = weights, na.rm=T),
           Label = paste(round(`SPI Score`,0))) %>%
    ggplot(aes(x=`SPI Score`, y=income, fill=income)) +
      geom_bar(stat="identity",position='dodge') +
      geom_text(aes(label=Label)) +
      scale_fill_manual(values=income_colors) +
      labs(
      title=str_wrap(paste(title, 'By Income', sep=" - "),100),
      caption = 'Source: World Bank. Statistical Performance Indicators.',
      subtitle= paste0('Based on data for ',end_date,' or the latest year available')
      ) +
      scale_y_discrete(limits = income) +
      expand_limits(x=c(0,100)) +
      theme_spi() +
      theme(legend.position = 'top')
    


  print(p3)


}

spi_time_charts  <- function(data, indicator, title) {
  

    
  # #add line graph over time
  p4 <- get(data)  %>%
    rename(data_available=!! indicator) %>%
    # right_join(spi_df_empty) %>%
    group_by(income, date) %>%
    mutate(data_available=if_else(is.na(data_available), as.numeric(NA), as.numeric(data_available))) %>%
    mutate(`SPI Score`=wtd.mean(data_available, weights = weights, na.rm=T),
           Label = paste(round(`SPI Score`,0))) %>%
    ungroup() %>%
    ggplot(aes(y=`SPI Score`, x=date, color=income)) +
      geom_point() +
      geom_line() +
      scale_color_manual(values=income_colors) +
      # geom_text_repel(aes(label=Label)) +
      labs(
      title=str_wrap(paste(title, 'By Date', sep=" - "),100),
      caption = 'Source: World Bank. Statistical Performance Indicators.'
      ) +
      expand_limits(y=c(0,100)) +
      theme_spi() +
      theme(legend.position = 'top')
  

            
      


  print(p4)
    
}

spi_country_charts  <- function(data, indicator, title) {
  

 indicator<-indicator

  map_df <- get(data) %>%
    filter(date==max(date, na.rm=T)) %>%
    filter(!(country %in% c('Greenland'))) %>% #drop a few countries for which we do not collect data.
    group_by( iso3c) %>%
    #summarise(across(!! indicator,last)) %>%
    rename(data_available=!! indicator) %>%
    select(iso3c, date, data_available, weights ) %>%
    right_join(country_metadata) %>%
    filter(region!="Aggregates") %>%
    mutate(data_available=if_else(is.na(data_available), as.numeric(NA), as.numeric(data_available)))    
  
   spi_groups_quantiles <- quantile(map_df$data_available, probs=c(1,2,3,4)/5,na.rm=T)
  
  SPI_map <- map_df %>%
    mutate(spi_groups=case_when(
      between(data_available, spi_groups_quantiles[4],100) ~ "Top Quintile",
      between(data_available, spi_groups_quantiles[3],spi_groups_quantiles[4]) ~ "4th Quintile",
      between(data_available, spi_groups_quantiles[2],spi_groups_quantiles[3]) ~ "3rd Quintile",
      between(data_available, spi_groups_quantiles[1],spi_groups_quantiles[2]) ~ "2nd Quintile",
      between(data_available, 0,spi_groups_quantiles[1]) ~ "Bottom 20%"
      
    )) %>%
    mutate(spi_groups=factor(spi_groups, 
                             levels=c("Top Quintile","4th Quintile","3rd Quintile","2nd Quintile","Bottom 20%" )))  
  
  #set color pallete
  col_pal <- c("#2ec4b6","#acece7","#f1dc76","#ffbf69","#ff9f1c")  
  names(col_pal) <- c("Top Quintile","4th Quintile","3rd Quintile","2nd Quintile","Bottom 20%" )
  

  # order regions by their mean score in the current year
  region_means <- SPI_map |>
    dplyr::group_by(region) |>
    dplyr::summarise(m = mean(data_available, na.rm = TRUE), .groups = "drop") |>
    dplyr::arrange(dplyr::desc(m)) |>
    dplyr::pull(region)

  p2_alt <- SPI_map |>
    dplyr::ungroup() |>
    dplyr::mutate(region = factor(region, levels = region_means)) |>
    ggplot(aes(x = data_available, y = region, color = spi_groups)) +
      geom_point() +
      geom_text(aes(label = country), position = position_jitter(width = .1, height = .4), check_overlap = TRUE) +
      labs(
        title    = stringr::str_wrap(paste(title, "By Country", sep = " - "), 100),
        caption  = "Source: World Bank. Statistical Performance Indicators.",
        subtitle = paste0("Based on data for ", end_date, " or the latest year available")
      ) +
      xlab("Score") +
      expand_limits(x = c(0, 100)) +
      scale_color_manual(
        name  = "SPI Score",
        values= c("Top Quintile"="#2ec4b6","4th Quintile"="#acece7","3rd Quintile"="#f1dc76","2nd Quintile"="#ffbf69","Bottom 20%"="#ff9f1c"),
        na.value = "grey"
      ) +
      theme_spi() +
      theme(legend.position = "top")

  p2_alt

}


spi_maturity_table <- function(data, indicators, reference_year) {

      df_overall <- get(data) %>%
      filter(date==as.numeric(reference_year)) %>% 
      select(iso3c, date, income, region, all_of(indicators), SPI.INDEX) 
    
    
    spi_groups_quantiles <- quantile(df_overall$SPI.INDEX, probs=c(1,2,3,4)/5,na.rm=T)
    
    df_overall <- df_overall %>%
      mutate(spi_groups=case_when(
        between(SPI.INDEX, spi_groups_quantiles[4],100) ~ "Top Quintile",
        between(SPI.INDEX, spi_groups_quantiles[3],spi_groups_quantiles[4]) ~ "4th Quintile",
        between(SPI.INDEX, spi_groups_quantiles[2],spi_groups_quantiles[3]) ~ "3rd Quintile",
        between(SPI.INDEX, spi_groups_quantiles[1],spi_groups_quantiles[2]) ~ "2nd Quintile",
        between(SPI.INDEX, 0,spi_groups_quantiles[1]) ~ "Bottom 20%"
      )) %>%
      mutate(spi_groups=factor(spi_groups, 
                               levels=c("Top Quintile","4th Quintile","3rd Quintile","2nd Quintile","Bottom 20%" )))  
    
    #produce by income
    sumstats<- df_overall %>%
      group_by(spi_groups) %>%
      filter(!is.na(spi_groups)) %>%
      select(spi_groups, all_of(indicators)) %>%
      summarise_all(~round(mean(., na.rm=T),1)) 
    
    #produce global number
    sumstats_gl<- df_overall %>%
      mutate(spi_groups='Global') %>%
      group_by(spi_groups) %>%
      select(spi_groups, all_of(indicators)) %>%
      summarise_all(~round(mean(., na.rm=T),1)) 
    
    
    #transpose data
    sumstats_df_long <-sumstats 
    
    sumstats_df <- as.data.frame(t(sumstats_df_long %>% select(-spi_groups)))
    colnames(sumstats_df) = sumstats_df_long$spi_groups 
    
    
    sumstats_df <- sumstats_df %>%
      rownames_to_column() %>%
      rename(series=rowname)
    
    
    #create labels df
    metadata_tab2_overall <- metadata_full %>% 
      janitor::clean_names() %>%
      transmute(series=source_id, 
                indicator_name=source_name)
    
    
    #add variable label
    sumstats_df <- sumstats_df %>%
      left_join(metadata_tab2_overall) %>%
      rename(Series=series,
             Label=indicator_name) %>%
      mutate(Label=if_else(is.na(Label),Series,Label)) %>%
      select(Label, c("Top Quintile","4th Quintile","3rd Quintile","2nd Quintile","Bottom 20%" ))

      sumstats_df
 

}


spi_group_table <- function(data, indicators, reference_year, group) {

      df_overall <- get(data) %>%
      filter(date==as.numeric(reference_year)) %>% 
      left_join(country_metadata) %>%
      select(iso3c, date, income, region, lending_type, all_of(indicators), SPI.INDEX) %>%
      rename(group=!! group)
    
    
    
    #produce by income
    sumstats<- df_overall %>%
      group_by(group) %>%
      filter(!is.na(group)) %>%
      select(group, all_of(indicators)) %>%
      summarise_all(~round(mean(., na.rm=T),1)) 
    
    #produce global number
    sumstats_gl<- df_overall %>%
      mutate(group='Global') %>%
      group_by(group) %>%
      select(group, all_of(indicators)) %>%
      summarise_all(~round(mean(., na.rm=T),1)) 
    
    
    #transpose data
    sumstats_df_long <-sumstats 
    
    sumstats_df <- as.data.frame(t(sumstats_df_long %>% select(-group)))
    colnames(sumstats_df) = sumstats_df_long$group 
    
    
    sumstats_df <- sumstats_df %>%
      rownames_to_column() %>%
      rename(series=rowname)
    
    
    #create labels df
    metadata_tab2_overall <- metadata_full %>% 
      janitor::clean_names() %>%
      transmute(series=source_id, 
                indicator_name=source_name)
    
    
    #add variable label
    sumstats_df <- sumstats_df %>%
      left_join(metadata_tab2_overall) %>%
      rename(Series=series,
             Label=indicator_name) %>%
      mutate(Label=if_else(is.na(Label),Series,Label)) %>%
      select(Label, everything()) %>%
      select(-Series)

      sumstats_df
 

}

lending_charts <- function(data, indicator, title) { 


 indicator<-indicator

  map_df <- get(data) %>%
    filter(date==max(date, na.rm=T)) %>%
    filter(!(country %in% c('Greenland'))) %>% #drop a few countries for which we do not collect data.
    group_by( iso3c) %>%
    #summarise(across(!! indicator,last)) %>%
    rename(data_available=!! indicator) %>%
    select(iso3c, date, data_available, weights ) %>%
    right_join(country_metadata) %>%
    mutate(data_available=if_else(is.na(data_available), as.numeric(NA), as.numeric(data_available)))    
  

  lending_list <- spi_index_df |> dplyr::distinct(lending_type) |> dplyr::pull(lending_type)
# then:
scale_y_discrete(limits = lending_list)
# and:
scale_color_manual(values = lending_colors)
scale_fill_manual(values  = lending_colors)

  
  p2_alt3 <- map_df %>%
    ungroup() %>%
    filter(region!='Aggregates') %>%
    mutate(`SPI Score`=(data_available),
           Label = paste(round(`SPI Score`,0))) %>%
    ggplot(aes(x=`SPI Score`, y=lending_type, color=lending_type)) +
      geom_point() +
      geom_text(aes(label=country), position=position_jitter(width=.1,height=.4), check_overlap=T) +
      labs(
      title=str_wrap(paste(title, 'By Lending Status', sep=" - "),100),
      caption = 'Source: World Bank. Statistical Performance Indicators.',
      subtitle= paste0('Based on data for ',end_date,' or the latest year available')
      ) +
      scale_y_discrete(limits = lending_list) +
      expand_limits(x=c(0,100)) +
      theme_spi() +
      theme(legend.position = 'top',
            title= element_text(size = 20),
            axis.title.y=element_blank(),
            text = element_text(size = 14)) 
   
p2_alt3 
  
 
}

lending_chart_aggregate <- function(data, indicator, title) { 


 indicator<-indicator

  map_df <- get(data) %>%
    filter(date==max(date, na.rm=T)) %>%
    filter(!(country %in% c('Greenland'))) %>% #drop a few countries for which we do not collect data.
    group_by( iso3c) %>%
    #summarise(across(!! indicator,last)) %>%
    rename(data_available=!! indicator) %>%
    select(iso3c, date, data_available, weights ) %>%
    right_join(country_metadata) %>%
    mutate(data_available=if_else(is.na(data_available), as.numeric(NA), as.numeric(data_available)))    
  

  lending_list <- spi_index_df |> dplyr::distinct(lending_type) |> dplyr::pull(lending_type)
# then:
scale_y_discrete(limits = lending_list)
# and:
scale_color_manual(values = lending_colors)
scale_fill_manual(values  = lending_colors)

  
  

  p2_alt3 <- map_df %>%
    group_by(lending_type) %>%
    filter(region!='Aggregates') %>%
    mutate(`SPI Score`=wtd.mean(data_available, weights = weights, na.rm=T),
           Label = paste(round(`SPI Score`,0))) %>%
    ggplot(aes(x=`SPI Score`, y=lending_type, fill=lending_type)) +
      geom_bar(stat="identity",position='dodge') +
      geom_text(aes(label=Label)) +
      labs(
      title=str_wrap(paste(title, 'By Lending Status', sep=" - "),100),
      caption = 'Source: World Bank. Statistical Performance Indicators.',
      subtitle= paste0('Based on data for ',end_date,' or the latest year available')
      ) +
      scale_y_discrete(limits = lending_list) +
      expand_limits(x=c(0,100)) +
      theme_spi() +
      theme(legend.position = 'top')
            # title= element_text(size = 20),
            # axis.title.y=element_blank(),
            # text = element_text(size = 14)) 
   
p2_alt3 
  
 
}



fcs_charts <- function(data, indicator, title) {
  map_df <- get(data) |>
    dplyr::filter(date == max(date, na.rm = TRUE)) |>
    dplyr::group_by(iso3c) |>
    dplyr::rename(data_available = !!indicator) |>
    dplyr::select(iso3c, country, fragile_conflict, date, data_available, weights) |>
    dplyr::ungroup() |>
    dplyr::mutate(data_available = if_else(is.na(data_available), NA_real_, as.numeric(data_available)))

  fcs_levels <- c("FCS country","Non-FCS country")
  ggplot(map_df |> dplyr::filter(!is.na(fragile_conflict)),
         aes(x = data_available, y = fragile_conflict, color = fragile_conflict)) +
    geom_point() +
    geom_text(aes(label = country), position = position_jitter(width = .1, height = .4), check_overlap = TRUE) +
    labs(
      title    = stringr::str_wrap(paste(title, "By Fragile and Conflict-affected Situations (FCS)", sep = " - "), 100),
      caption  = "Source: World Bank. Statistical Performance Indicators.",
      subtitle = paste0("Based on data for ", end_date, " or the latest year available")
    ) +
    scale_y_discrete(limits = fcs_levels) +
    expand_limits(x = c(0, 100)) +
    theme_spi() +
    theme(legend.position = "top")
}

fcs_chart_aggregate <- function(data, indicator, title) {
  map_df <- get(data) |>
    dplyr::filter(date == max(date, na.rm = TRUE)) |>
    dplyr::group_by(iso3c) |>
    dplyr::rename(data_available = !!indicator) |>
    dplyr::select(iso3c, fragile_conflict, date, data_available, weights) |>
    dplyr::ungroup() |>
    dplyr::mutate(data_available = if_else(is.na(data_available), NA_real_, as.numeric(data_available)))

  fcs_levels <- c("FCS country","Non-FCS country")
  map_df |>
    dplyr::filter(!is.na(fragile_conflict)) |>
    dplyr::group_by(fragile_conflict) |>
    dplyr::mutate(`SPI Score` = Hmisc::wtd.mean(data_available, weights = weights, na.rm = TRUE),
                  Label      = paste(round(`SPI Score`, 0))) |>
    ggplot(aes(x = `SPI Score`, y = fragile_conflict, fill = fragile_conflict)) +
    geom_bar(stat = "identity", position = "dodge") +
    geom_text(aes(label = Label)) +
    labs(
      title    = stringr::str_wrap(paste(title, "By Fragile and Conflict-affected Situations (FCS)", sep = " - "), 100),
      caption  = stringr::str_wrap("Source: World Bank. Statistical Performance Indicators. Non-FCS countries include all countries not classified as FCS.", 70),
      subtitle = paste0("Based on data for ", end_date, " or the latest year available")
    ) +
    scale_y_discrete(limits = fcs_levels) +
    expand_limits(x = c(0, 100)) +
    theme_spi() +
    theme(legend.position = "top")
}




#define function to pull data from UN Stats and return
un_pull <- function(series,start, end) {
  # jsonlite::fromJSON(paste('https://unstats.un.org/SDGAPI/v1/sdg/Series/Data?seriesCode=',series,'&timePeriodStart=',start,'&timePeriodEnd=',end,'&pageSize=10000',sep=""), flatten = TRUE)$data %>%
      jsonlite::fromJSON(paste('https://unstats.un.org/SDGAPI/v1/sdg/Series/Data?seriesCode=',series,'&pageSize=10000',sep=""), flatten = TRUE)$data %>%

    as_tibble() %>%
    mutate(date=timePeriodStart) %>%
    right_join(iso3c)
    
}  

FitFlextableToPage <- function(ft, pgwidth = 6){

  ft_out <- ft %>% 
    add_footer_lines(values = "Source: World Bank. Statistical Performance Indicators."                 ) %>%
    autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}

# add equations to plots
eq_plot_txt <- function(data, inp, var) {
    eq <- lm_robust(data[[var]] ~ data[[inp]], data = data, se_type = "HC2")
    coef <- round(coef(eq), 2)
    std_err <- round(sqrt(diag(vcov(eq))), 2)
    r_2 <- round(summary(eq)$r.squared, 2)
    sprintf(" y = %.2f + %.2f x, R<sup>2</sup> = %.2f <br> (%.2f) <span style='color:white'> %s</span> (%.2f) ", coef[1], coef[2], r_2[1], std_err[1], "s", std_err[2])
}


tile_chart <- function(indicators) {
    tile_df <- spi_agg_df %>%
      relocate(SPI.D3.13.CLMT, .after = SPI.D3.12.CNSP) %>%
      filter(between(date,start_date,end_date)) %>%
      select(date, indicators) %>%
      pivot_longer(
        cols=indicators,
        names_to = 'source_id',
        values_to = 'Score'
      ) %>%
      left_join(metadata_full) %>%
      filter(!is.na(source_name)) %>%
      mutate(source_name=str_wrap(source_name, 30),
             Score=round(Score,2)) %>%
      mutate(source_name=factor(source_name, levels=unique(source_name))) 
      
    # tileplot 
    ggplot(tile_df, aes(x=date, y=source_name, fill= Score)) + 
      geom_tile(color = "white") +
      geom_text(aes(label=Score), color='white', size=5) +
      ylab('Indicator') +
      theme_spi() +
      #scale_fill_binned(guide = guide_coloursteps(show.limits = TRUE)) +
      scale_y_discrete(limits = rev(levels(tile_df$source_name))) +
        theme(
          panel.grid.minor.y = element_blank(),
          panel.grid.major.y = element_blank(),
          axis.text.y=element_text(size=12),
          #legend.text = element_text(size=14),
          plot.title = element_text(size=16)
          
        )
}

tile_table <- function(indicators) {
    tile_df <- spi_agg_df %>%
      relocate(SPI.D3.13.CLMT, .after = SPI.D3.12.CNSP) %>%
      filter(between(date,start_date,end_date)) %>%
      select(date, indicators) %>%
      #make date the columns and indicators the rows. Pivot data
      pivot_longer(cols = indicators, names_to = 'source_id', values_to = 'value') %>%
      mutate(value=round(value,2)) %>%
      pivot_wider(names_from = date, values_from = value) %>%
      left_join(metadata_full) %>%
      filter(!is.na(source_name)) %>%
      mutate(source_name=str_wrap(source_name, 30)) %>%
      mutate(source_name=factor(source_name, levels=unique(source_name))) %>%
      #keep just source_name and the date columns
      select(source_name, all_of(as.character(seq(start_date, end_date, by=1)))) %>%
      rename(' '='source_name') 
    
    flextable(tile_df) %>%
      theme_alafoli() %>%
      bg(j=2:ncol(tile_df), 
         bg=scales::col_numeric(palette='Blues', domain=c(0,1))) %>%
      color(j=2:ncol(tile_df), color='white') %>%
      #center text
      align(j=2:ncol(tile_df), align='center', part='all')  %>%
      autofit() 
}

```


```{r}
#| label: missinglist
names(spi_index_df)[names(spi_index_df) == "country.x"] <- "country"
#get list of missing countries
missing_list <- spi_index_df %>%
  filter(date == end_date, is.na(SPI.INDEX)) %>%
  distinct(country) %>%          # or distinct(iso3c) if you prefer codes
  pull(country)

#turn into comma separated list
missing_list <- paste(missing_list, collapse=", ")

```

In `r end_date`, the SPI Overall Score is available for `r nrow(spi_index_df %>% filter(!is.na(SPI.INDEX)) %>% filter(date==end_date))` economies, representing more than 99 percent of the world population.[^1] There has been an increase in the number of economies with an SPI overall score since 2016, with a rise from 167 economies to `r nrow(spi_index_df %>% filter(!is.na(SPI.INDEX)) %>% filter(date==end_date))`.[^2] This growth is largely due to the inclusion of more economies with a data openness score from Open Data Watch.

[^1]: The countries without an SPI Overall Score are `r missing_list`.

[^2]:  The World Bank's World Development Indicators includes 217 economies. If an economy does not have data for one of the indicators used to generate the SPI overall score, no score is produced for this country, as the SPI does not rely on modelling or imputation to produce the scores.


These revisions have had a generally minimal impact on overall SPI scores. In 2022, the correlation between previous and revised SPI scores was `r round(spi_index_correlation,2)`, demonstrating a high level of consistency.



# SPI Performance Snapshot: 2025

On November XXX, 2025, the World Bank launched the latest data for the Statistical Performance Indicators (SPI). The SPI offers a transparent way of assessing national statistical systems, with over 50 indicators tracking 187 economies from around the globe. The SPI breaks down national statistical performance into five pillars and 22 dimensions, each backed by open data and code. Dive into the SPI data here or learn more about the framework to see how countries rank.

The 2025 SPI release features data from 2024 and updates from previous years, compiled with insights from global partners (including the World Bank, IMF, and UN). It’s grown to include 188 economies, up from 167 in 2016, and now covers over 99% of the world’s population. 

SPI scores have improved worldwide by an average of 12.5% since 2016, largely driven by gains in data services. North America and Europe & Central Asia rank highest, with East Asia & the Pacific and Latin America & the Caribbean following. While wealthier nations perform best, lower- and lower-middle-income countries have shown the fastest statistical improvement—a promising sign for global data equity.

As of 2024, SPI scores vary - depending on income levels. High-income regions - mainly Europe, North America and Australia - have the highest SPI scores. Conversely, regions - with low to middle income countries (LMICs) - such as, East Asia & Pacific, Middle East & North Africa and Sub-Saharan Africa are the lowest. From 2016 to 2024, the (unweighted) average SPI scores in low-income nations increased by 10 percentage points – compared with 12 percentage points for high-income nations. 

Why does income tend to generate higher SPI scores? One hypothesis is that high-income nations - as proxied by GNI - bring in larger tax revenues. This can be spent on improving the National Statistical Systems (NSS) by upgrading data infrastructure – for instance, purchasing more computers, hiring NSO staff and improving data collection. 

```{r}
library(dplyr)
library(ggplot2)
install.packages("maps")
library(maps)
library(scales)

# 1. Keep 2024 SPI and harmonise country names to map_data("world")$region
spi_2024 <- df_SPI_index %>%
  filter(date == 2024) %>%
  mutate(
    region = dplyr::case_when(
      country == "Korea, Rep."              ~ "South Korea",
      country == "United States"            ~ "USA",
      country == "Russian Federation"       ~ "Russia",
      country == "Egypt, Arab Rep."         ~ "Egypt",
      country == "Iran, Islamic Rep."       ~ "Iran",
      country == "Venezuela, RB"            ~ "Venezuela",
      country == "Gambia, The"              ~ "Gambia",
      country == "Congo, Rep."              ~ "Republic of Congo",
      country == "Congo, Dem. Rep."         ~ "Democratic Republic of the Congo",
      country == "Yemen, Rep."              ~ "Yemen",
      country == "Bahamas, The"             ~ "Bahamas",
      country == "Cabo Verde"               ~ "Cape Verde",
      country == "Czechia"                  ~ "Czech Republic",
      country == "Slovak Republic"          ~ "Slovakia",
      country == "United Kingdom"           ~ "UK",
      country == "Hong Kong SAR, China"     ~ "Hong Kong",
      country == "Macao SAR, China"         ~ "Macau",
      country == "Syrian Arab Republic"     ~ "Syria",
      country == "Lao PDR"                  ~ "Laos",
      TRUE                                  ~ country
    )
  ) %>%
  select(region, SPI.INDEX)

# 2. Get simple world map data
world <- map_data("world")

# 3. Join SPI to map polygons by country name
world_spi <- world %>%
  left_join(spi_2024, by = "region")

# 4. Plot
ggplot(world_spi, aes(long, lat, group = group)) +
  geom_polygon(aes(fill = SPI.INDEX), colour = "grey70", size = 0.1) +
  scale_fill_viridis_c(
    option = "plasma",
    limits = c(0, 100),          # force 0–100 scale
    oob = squish,                # clamp any out-of-range values
    na.value = "grey90",
    name = "SPI Index (0–100)"
  ) +
  coord_quickmap() +
  labs(
    title   = "SPI Overall Score by Country",
    caption = "Source: World Bank Statistical Performance Indicators (SPI) Index, 2024"
  ) +
  theme_void() +
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5)
  )
```


# SPI Performance Change Over Time: 2016-2024
However, SPI growth has been driven by lower & middle-income countries. In these countries, spending has a much higher impact. An additional staff member has a far bigger impact at an NSO of 5 workers than an NSO of 500. Consequently, lower- to upper-middle countries in Latin & Central American Africa, Eastern European and South Asia have realised most SPI gains.

```{r}

map_data("world") %>%
  
  left_join(
    df_SPI_index %>%
      filter(date %in% c(2016, 2024)) %>%
      select(country, date, SPI.INDEX) %>%
      tidyr::pivot_wider(
        names_from = date,
        values_from = SPI.INDEX,
        names_prefix = "SPI_"
      ) %>%
      filter(!is.na(SPI_2016), !is.na(SPI_2024)) %>%
      mutate(
        growth_pp = SPI_2024 - SPI_2016,
        
        # --- CATEGORISE INTO FOUR GROUPS ---
        growth_cat = case_when(
          growth_pp < 0              ~ "Decrease",
          growth_pp < 10             ~ "0–10 point increase",
          growth_pp < 20             ~ "10–20 point increase",
          growth_pp >= 20            ~ "20+ point increase"
        ),
        
        # --- Harmonise map country names ---
        region = case_when(
          country == "Korea, Rep."              ~ "South Korea",
          country == "United States"            ~ "USA",
          country == "Russian Federation"       ~ "Russia",
          country == "Egypt, Arab Rep."         ~ "Egypt",
          country == "Iran, Islamic Rep."       ~ "Iran",
          country == "Venezuela, RB"            ~ "Venezuela",
          country == "Gambia, The"              ~ "Gambia",
          country == "Congo, Rep."              ~ "Republic of Congo",
          country == "Congo, Dem. Rep."         ~ "Democratic Republic of the Congo",
          country == "Yemen, Rep."              ~ "Yemen",
          country == "Bahamas, The"             ~ "Bahamas",
          country == "Cabo Verde"               ~ "Cape Verde",
          country == "Czechia"                  ~ "Czech Republic",
          country == "Slovak Republic"          ~ "Slovakia",
          country == "United Kingdom"           ~ "UK",
          country == "Hong Kong SAR, China"     ~ "Hong Kong",
          country == "Macao SAR, China"         ~ "Macau",
          country == "Syrian Arab Republic"     ~ "Syria",
          country == "Lao PDR"                  ~ "Laos",
          TRUE                                  ~ country
        ),
        
        # order legend manually (top to bottom)
        growth_cat = factor(
          growth_cat,
          levels = c(
            "20+ point increase",
            "10–20 point increase",
            "0–10 point increase",
            "Decrease"
          )
        )
        
      ) %>%
      select(region, growth_cat),
    
    by = "region"
  ) %>%
  
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(aes(fill = growth_cat), colour = "grey70", size = 0.1) +
  
  # Strong, visible palette (4 colours)
  scale_fill_manual(
    values = c(
      "20+ point increase"     = "#005F73",   # dark teal
      "10–20 point increase"   = "#4EB3D3",   # medium teal
      "0–10 point increase"    = "#F2C14E",   # amber
      "Decrease"               = "#D7301F"    # deep orange/red
    ),
    name = "SPI change 2016 → 2024",
    drop = FALSE
  ) +
  
  guides(fill = guide_legend(na.translate = FALSE)) +
  
  coord_quickmap() +
  labs(
    title    = "Change in SPI Overall Score by Country, 2016–2024",
    subtitle = "Categorised by percentage point increase",
    caption  = "Source: World Bank Statistical Performance Indicators (SPI)"
  ) +
  theme_void() +
  theme(
    legend.position = "right",
    plot.title      = element_text(hjust = 0.5),
    plot.subtitle   = element_text(hjust = 0.5)
  )

```
# What pillars are driving most of these gains?
The SPI framework assesses the maturity and performance of national statistical systems in five key areas, called pillars.  The five pillars are: The SPI is broken down into five separate pillars: i) Data Use, ii) Data Services iii) Data Products iv) Data Sources v) Data Infrastructure. 

What pillars of the SPI score are driving most of these gains? Since 2016, the Data Services score has increased by an average of 25 percent, disproportionately driven by countries with mid to low SPI scores. For example, Data Openness - as proxied by the ODIN openness score - has risen by approximately 66% from 2016. This is somewhat promising; it suggests that lower-scoring countries are catching up and converging to their higher-income counterparts. 

```{r}
#| label: tbl-tile1

pillar_avg_ts <- df_SPI_index %>%
  filter(date >= 2016) %>%        # <-- restrict to 2016 onwards
  group_by(date) %>%
  summarise(
    Overall_SPI = mean(SPI.INDEX, na.rm = TRUE),
    Pillar_1 = mean(SPI.INDEX.PIL1, na.rm = TRUE),
    Pillar_2 = mean(SPI.INDEX.PIL2, na.rm = TRUE),
    Pillar_3 = mean(SPI.INDEX.PIL3, na.rm = TRUE),
    Pillar_4 = mean(SPI.INDEX.PIL4, na.rm = TRUE),
    Pillar_5 = mean(SPI.INDEX.PIL5, na.rm = TRUE)
  ) %>%
  pivot_longer(
    cols = -date,
    names_to = "pillar",
    values_to = "value"
  )

ggplot(pillar_avg_ts, aes(x = date, y = value, colour = pillar)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(limits = c(20, 100)) +
  labs(
    x = "Year",
    y = "Average Score",
    colour = "Indicator"
  ) +
  theme_minimal(base_size = 13)


```
Despite certain SPI Pillars improving, not all SPI Pillars have followed suit. In particular, the overall growth of Data Sources has stalled, growing only 3% since 2016. This is partly attributable to the pandemic. COVID severely disrupted National Statistical Offices' ability to collect data, particularly in LMICs where COVID exacerbated the impact of limited data infrastructure. Data shows only a handful of countries have grown their Data Sources figures by more than 10 points. Most countries have grown 0-10 points or declined.

The hit to data sources has been largely uneven - in particular SPI survey scores. COVID delayed country capacity to produce timely, accurate and granular statistics, particularly in LMICs where it exacerbated the effects of low data infrastructure.  63% of NSOs in high-income countries reported disruptions in their statistical production due to the pandemic, whereas this figure stood at 88% for NSOs in LMICs — 25 percentage points higher. Untimely statistics - especially during periods of crisis - delay decision-making which are crucial for effective response measures. Unsurprisingly, countries with the lowest statistical capacity scores were the hardest hit; most of these countries still have not recovered.

# While resources are an issue, some countries have persevered: Income vs SPI

Income-level is a key predictor of statistical capacity. However, certain LMICs – like Burkina Faso, Rwanda and the Philippines – have performed better than the general trend. 

Why are these countries outliers? Take Burkina Faso.  The National Institute of Statistics and Demography (INSD) has adopted novel digitalisation and innovative methods for data collection. This resulted from the well-developed 2021-25 ‘National Strategy for the Development of Official Statistics’ (Schéma Directeur de la Statistique 2021–2025). Over this period, the INSD i) modernised statistical databases ii) increased geospatial data availability and iii) enhanced IT infrastructure. The INSD has taken a proactive approach to upskilling and digitalising their statistical ecosystem. As a result, Burkina Faso has become a regional leader in data collection efforts - increasing their SPI score from 49% in 2016 to 76% to 2024 - and serves as a model for other LMICs to increase uptake of data to drive sustainable development.  


# Country case study at the pillar-level

```{r}

# 1. Identify Burkina Faso's region
bfa_region <- df_SPI_index %>%
  filter(country == "Burkina Faso") %>%
  distinct(region) %>%
  pull()

# 2. Burkina Faso pillar values, 2016 & 2024
bfa_pillars <- df_SPI_index %>%
  filter(country == "Burkina Faso",
         date %in% c(2016, 2024)) %>%
  select(
    country, date,
    SPI.INDEX.PIL1, SPI.INDEX.PIL2, SPI.INDEX.PIL3,
    SPI.INDEX.PIL4, SPI.INDEX.PIL5
  )

# 3. Regional average (same region), 2016 & 2024
region_pillars <- df_SPI_index %>%
  filter(region == bfa_region,
         date %in% c(2016, 2024)) %>%
  group_by(date) %>%
  summarise(
    SPI.INDEX.PIL1 = mean(SPI.INDEX.PIL1, na.rm = TRUE),
    SPI.INDEX.PIL2 = mean(SPI.INDEX.PIL2, na.rm = TRUE),
    SPI.INDEX.PIL3 = mean(SPI.INDEX.PIL3, na.rm = TRUE),
    SPI.INDEX.PIL4 = mean(SPI.INDEX.PIL4, na.rm = TRUE),
    SPI.INDEX.PIL5 = mean(SPI.INDEX.PIL5, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(country = paste0(bfa_region, " average"))

# 4. Stack BF + regional avg and compute growth 2016→2024 per pillar
pillar_growth <- bind_rows(bfa_pillars, region_pillars) %>%
  pivot_longer(
    cols = starts_with("SPI.INDEX.PIL"),
    names_to = "pillar",
    values_to = "value"
  ) %>%
  mutate(
    pillar = recode(pillar,
      "SPI.INDEX.PIL1" = "Pillar 1",
      "SPI.INDEX.PIL2" = "Pillar 2",
      "SPI.INDEX.PIL3" = "Pillar 3",
      "SPI.INDEX.PIL4" = "Pillar 4",
      "SPI.INDEX.PIL5" = "Pillar 5"
    )
  ) %>%
  pivot_wider(names_from = date, values_from = value) %>%
  mutate(growth = `2024` - `2016`)

# Split out Burkina vs regional average
bfa_growth <- pillar_growth %>%
  filter(country == "Burkina Faso")

region_growth <- pillar_growth %>%
  filter(country != "Burkina Faso") %>%
  mutate(
    reg_label_val = signif(growth, 1),                          # 1 significant figure
    reg_label = paste0("Reg. avg: ", reg_label_val)
  )

# 5. Plot: bars = Burkina Faso; dotted horizontal line = regional avg
ggplot(bfa_growth, aes(x = pillar, y = growth)) +
  geom_col(fill = "#1f78b4", alpha = 0.85) +                     # coloured bars
  geom_errorbar(
    data = region_growth,
    aes(x = pillar, ymin = growth, ymax = growth),
    inherit.aes = FALSE,
    width = 0.6,
    linetype = "dotted",
    linewidth = 0.6
  ) +
  geom_text(
    data = region_growth,
    aes(x = pillar, y = growth, label = reg_label),
    inherit.aes = FALSE,
    vjust = -0.6,
    size = 3
  ) +
  scale_y_continuous(
    name = "Growth in score (2016 → 2024)",
    expand = expansion(mult = c(0, 0.15))
  ) +
  labs(
    x = "SPI Pillar",
    title = "Burkina Faso’s SPI Pillar Growth vs Regional Average",
    subtitle = paste0("Bars = Burkina Faso; dotted line = ", bfa_region, " average")
  ) +
  theme_minimal(base_size = 13)

```


```{r}
library(WDI)
library(dplyr)
library(ggplot2)
library(ggrepel)

# 1. Get GDP per capita (current US$) for 2024
gdp_pc_2024 <- WDI(
  indicator = "NY.GDP.PCAP.CD",   # GDP per capita (current US$)
  start = 2024,
  end   = 2024,
  extra = TRUE
) %>%
  filter(region != "Aggregates") %>%      # drop World/regions
  select(iso3c, country = country, year, gdp_pc_usd = NY.GDP.PCAP.CD)

# 2. SPI overall index for 2024
spi_2024 <- df_SPI_index %>%
  filter(date == 2024) %>%
  select(iso3c, country, SPI.INDEX)

# 3. Merge GDP per capita with SPI by iso3c
spi_gdp_pc_2024 <- spi_2024 %>%
  inner_join(gdp_pc_2024 %>% select(iso3c, gdp_pc_usd), by = "iso3c") %>%
  filter(!is.na(gdp_pc_usd), gdp_pc_usd > 0)

# 4. Fit linear model SPI ~ log10(GDP per capita)
model <- lm(SPI.INDEX ~ log10(gdp_pc_usd), data = spi_gdp_pc_2024)

spi_gdp_pc_2024 <- spi_gdp_pc_2024 %>%
  mutate(
    pred  = predict(model, .),
    resid = SPI.INDEX - pred
  )

# 5. Choose some countries to always label (edit this list as you like)
highlight_countries <- c("Norway", "Sweden", "United States", "India", "Kenya", "Brazil")

# 6. Mark:
#    - highlight countries
#    - top 5 positive residuals (overperformers)
spi_gdp_pc_2024 <- spi_gdp_pc_2024 %>%
  mutate(
    label_special = country %in% highlight_countries,
    label_resid   = rank(-resid, ties.method = "first") <= 5,
    label_any     = label_special | label_resid
  )

# data for labels only
label_data <- spi_gdp_pc_2024 %>% filter(label_any)

# 7. Plot
ggplot(spi_gdp_pc_2024, aes(x = gdp_pc_usd, y = SPI.INDEX)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 0.8, colour = "grey30") +
  geom_text_repel(
    data = label_data,
    aes(label = country),
    size = 3,
    max.overlaps = Inf
  ) +
  scale_x_log10(labels = scales::dollar_format(prefix = "$", big.mark = ",")) +
  labs(
    x = "GDP per capita (current US$, log scale)",
    y = "SPI overall index (0–100)",
    title    = "GDP per capita and Statistical Performance, 2024",
    subtitle = "Labels show selected countries and those with the highest positive residuals from the fitted line",
    caption  = "Source: World Bank WDI (NY.GDP.PCAP.CD), Statistical Performance Indicators (SPI)"
  ) +
  theme_minimal()

```

Ultimately, the SPI can assist with these developments. By tracking what gets measured, the SPI helps countries identify gaps in their statistical ecosystem, and plan how best to address them. 



Note: N=188 economies.
